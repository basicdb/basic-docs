---
title: 'Using the API'
description: 'Adding authentication to your project.'
---

# Authentication with API
Basic uses OAuth 2.0 for authentication. For more details on OAuth 2.0, read more about [Introduction to OAuth 2.0](/others/auth-basic#introduction-to-oauth-2-0) or refer to a [pseudocode example](/others/auth-basic#pseudocode-example).

<Steps>

    <Step title="Redirect user to /authorize">
        Create a button that redirects the user to the login page, with the appropriate parameters.

        Redirect URL: 
        `https://api.basic.tech/authorize`. For more information on how to use the redirect URL, check out the [required parameters](/others/auth-basic#required-parameters).   

        Example:
        ```typescript SignInButton.tsx
        // Create a button that redirects the user to the login page
        import React from 'react';

        const SignInButton: React.FC = () => {
          const handleSignIn = () => {
            // make sure to replace the redirect_uri, client_id, scope, and state with your actual values
            const redirectUrl = `https://api.basic.tech/authorize?redirect_uri=${encodeURIComponent('https://your-app.com/callback')}&response_type=code&client_id=${encodeURIComponent('YOUR_BASIC_PROJECT_ID')}&scope=profile&state=${encodeURIComponent('RANDOM_STRING')}`;
            window.location.href = redirectUrl;
          };

          return (
            <button onClick={handleSignIn}>
              Sign in with Basic
            </button>
          );
        };

        // If you wanted to use this button in your app, you would import it and use it like this:
        // <SignInButton />
        ```
    </Step>

    <Step title="User grants access and is redirected back to your app with an authorization code">
        The authorization code will be in the URL as a `code` query parameter.
        For example: 
        `https://your-app.com/callback?code=1234567890`.
        You need to extract the code from the URL and use it in the next step.
        ```typescript CallbackPage.tsx
        // Extract the code from the URL
        const code = new URL(window.location.href).searchParams.get('code');
        ```
    </Step>

    <Step title="Exchange the authorization code for an access token and refresh token">
        Make a post request to `/token` with the authorization code in the body. The response will be a JSON object with the access token and refresh token.

        Token URL: 
        `https://api.basic.tech/token`

        Example:
        ``` javascript ExchangeToken.js
        const exchangeToken = async (code) => {
            const options = {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({code: code})
            };

            try {
                const response = await fetch('https://api.basic.tech/token', options);
                const data = await response.json();

                if (response.ok) {
                    // Store tokens in cookies
                    document.cookie = `access_token=${data.access_token}; path=/; max-age=3600; secure; samesite=strict`;
                    document.cookie = `refresh_token=${data.refresh_token}; path=/; max-age=2592000; secure; samesite=strict`;

                    // Alternatively, store in localStorage (less secure)
                    // localStorage.setItem('access_token', data.access_token);
                    // localStorage.setItem('refresh_token', data.refresh_token);

                    return data;
                } else {
                    throw new Error('Failed to exchange token');
                }
            } catch (error) {
                console.error('Error exchanging token:', error);
                throw error;
            }
        };

        // Usage:
        // const code = new URL(window.location.href).searchParams.get('code');
        // exchangeToken(code).then(tokens => console.log(tokens)).catch(error => console.error(error));
        ```
        
    </Step>

</Steps>

# Using the database
You can use the REST API to read and write to the user's database. Checkout the [API Reference](/api-reference/db/get-items) to get started.
Before making any requests, you should validate that the access and refresh tokens are not expired.

``` javascript ValidateToken.js
import { decode, JwtPayload } from 'jsonwebtoken';

interface TokenResponse {
  access_token: string;
  refresh_token: string;
}

const getTokenFromCookie = (tokenName: string): string | null => {
  const cookies = document.cookie.split(';');
  for (const cookie of cookies) {
    const [name, value] = cookie.trim().split('=');
    if (name === tokenName) {
      return decodeURIComponent(value);
    }
  }
  return null;
};

const setTokenCookie = (tokenName: string, tokenValue: string, maxAge: number) => {
  document.cookie = `${tokenName}=${encodeURIComponent(tokenValue)}; path=/; max-age=${maxAge}; secure; samesite=strict`;
};

const validateTokens = async (): Promise<TokenResponse> => {
  let accessToken = getTokenFromCookie('access_token');
  let refreshToken = getTokenFromCookie('refresh_token');

  if (!accessToken || !refreshToken) {
    throw new Error('No tokens found in cookies');
  }

  const isTokenExpired = (token: string): boolean => {
    const decodedToken = decode(token) as JwtPayload;
    if (!decodedToken || !decodedToken.exp) return true;
    return Date.now() >= decodedToken.exp * 1000;
  };

  if (!isTokenExpired(accessToken)) {
    return { access_token: accessToken, refresh_token: refreshToken };
  }

  if (!isTokenExpired(refreshToken)) {
    try {
      const response = await fetch('https://api.basic.tech/token', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ refresh_token: refreshToken }),
      });

      if (!response.ok) throw new Error('Failed to refresh token');

      const newTokens: TokenResponse = await response.json();
      
      // Update cookies with new tokens
      setTokenCookie('access_token', newTokens.access_token, 3600); // 1 hour
      setTokenCookie('refresh_token', newTokens.refresh_token, 2592000); // 30 days
      
      return newTokens;
    } catch (error) {
      console.error('Error refreshing token:', error);
      throw error;
    }
  }

  // If both tokens are expired, redirect to re-authenticate
  window.location.href = 'https://api.basic.tech/authorize?redirect_uri=YOUR_REDIRECT_URI&response_type=code&client_id=YOUR_CLIENT_ID&scope=profile&state=RANDOM_STRING';
  throw new Error('Both tokens expired. Redirecting to re-authenticate.');
};

// Usage example
const checkAndRefreshTokens = async () => {
  try {
    const validTokens = await validateTokens();
    console.log('Valid tokens:', validTokens);
    // Use validTokens.access_token for your API requests
  } catch (error) {
    console.error('Token validation failed:', error);
  }
};

checkAndRefreshTokens();
```
